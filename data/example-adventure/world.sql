-- Adventure Engine World Data
-- Generated by adventure-maker

BEGIN;

-- Drop existing tables
DROP TABLE IF EXISTS container_lock_keys CASCADE;
DROP TABLE IF EXISTS container_items CASCADE;
DROP TABLE IF EXISTS exit_lock_keys CASCADE;
DROP TABLE IF EXISTS dig_definitions CASCADE;
DROP TABLE IF EXISTS room_exits CASCADE;
DROP TABLE IF EXISTS room_objects CASCADE;
DROP TABLE IF EXISTS exits CASCADE;
DROP TABLE IF EXISTS game_objects CASCADE;
DROP TABLE IF EXISTS rooms CASCADE;
DROP TABLE IF EXISTS player_state CASCADE;
DROP TABLE IF EXISTS player_verbs CASCADE;

-- Rooms table
CREATE TABLE rooms (
  id INTEGER PRIMARY KEY,
  name TEXT NOT NULL,
  description TEXT NOT NULL,
  dig_enabled BOOLEAN NOT NULL DEFAULT false,
  dig_fail_message TEXT,
  background_image TEXT
);

-- Game Objects table
CREATE TABLE game_objects (
  id INTEGER PRIMARY KEY,
  name TEXT NOT NULL,
  description TEXT NOT NULL,
  object_type TEXT NOT NULL CHECK (object_type IN ('item', 'container')),
  -- Item fields
  item_size INTEGER,
  item_weight INTEGER,
  -- Container fields
  container_size INTEGER,
  container_lock_fail_message TEXT,
  container_lock_success_message TEXT,
  container_lock_unlocked_desc TEXT,
  container_lock_state TEXT CHECK (container_lock_state IN ('locked', 'unlocked', NULL))
);

-- Exits table
CREATE TABLE exits (
  id INTEGER PRIMARY KEY,
  name TEXT NOT NULL,
  description TEXT NOT NULL,
  from_room_id INTEGER NOT NULL REFERENCES rooms(id),
  to_room_id INTEGER NOT NULL REFERENCES rooms(id),
  -- Lock fields (NULL if not locked)
  lock_fail_message TEXT,
  lock_success_message TEXT,
  lock_state TEXT CHECK (lock_state IN ('locked', 'unlocked', NULL))
);

-- Exit lock key items (junction table)
CREATE TABLE exit_lock_keys (
  exit_id INTEGER NOT NULL REFERENCES exits(id),
  key_item_id INTEGER NOT NULL REFERENCES game_objects(id),
  PRIMARY KEY (exit_id, key_item_id)
);

-- Container items (junction table)
CREATE TABLE container_items (
  container_id INTEGER NOT NULL REFERENCES game_objects(id),
  item_name TEXT NOT NULL,
  item_id INTEGER NOT NULL REFERENCES game_objects(id),
  PRIMARY KEY (container_id, item_name)
);

-- Container lock key items (junction table)
CREATE TABLE container_lock_keys (
  container_id INTEGER NOT NULL REFERENCES game_objects(id),
  key_item_id INTEGER NOT NULL REFERENCES game_objects(id),
  PRIMARY KEY (container_id, key_item_id)
);

-- Room-Exit associations
CREATE TABLE room_exits (
  room_id INTEGER NOT NULL REFERENCES rooms(id),
  exit_name TEXT NOT NULL,
  exit_id INTEGER NOT NULL REFERENCES exits(id),
  PRIMARY KEY (room_id, exit_name)
);

-- Room-Object associations
CREATE TABLE room_objects (
  room_id INTEGER NOT NULL REFERENCES rooms(id),
  object_name TEXT NOT NULL,
  object_id INTEGER NOT NULL REFERENCES game_objects(id),
  PRIMARY KEY (room_id, object_name)
);

-- Dig definitions
CREATE TABLE dig_definitions (
  room_id INTEGER NOT NULL REFERENCES rooms(id),
  sequence_order INTEGER NOT NULL,
  success_message TEXT NOT NULL,
  game_object_id INTEGER REFERENCES game_objects(id),
  PRIMARY KEY (room_id, sequence_order)
);

-- Player state
CREATE TABLE player_state (
  id INTEGER PRIMARY KEY DEFAULT 1,
  current_room_id INTEGER NOT NULL REFERENCES rooms(id),
  CHECK (id = 1)  -- Ensure only one player state row
);

-- Player inventory
CREATE TABLE player_inventory (
  object_name TEXT NOT NULL PRIMARY KEY,
  object_id INTEGER NOT NULL REFERENCES game_objects(id)
);

-- Player verb aliases
CREATE TABLE player_verbs (
  verb_alias TEXT NOT NULL PRIMARY KEY,
  verb_target TEXT NOT NULL
);


-- Insert Rooms
INSERT INTO rooms (id, name, description, dig_enabled, dig_fail_message, background_image) VALUES (1, 'The Front Porch', 'You stand on a weathered wooden porch. The paint is peeling and the boards creak beneath your feet. A rusty key lies discarded in the corner. The front door looms before you.', false, 'You can''t do that here..', NULL);
INSERT INTO rooms (id, name, description, dig_enabled, dig_fail_message, background_image) VALUES (2, 'Main Hallway', 'You enter a grand hallway with faded wallpaper and a dusty chandelier overhead. Portraits of stern-faced ancestors line the walls. To your left is the kitchen door, and to your right, a door leading to the library.', false, 'You can''t do that here..', NULL);
INSERT INTO rooms (id, name, description, dig_enabled, dig_fail_message, background_image) VALUES (3, 'Kitchen', 'A dated kitchen with chipped tiles and old wooden cabinets. The smell of must hangs in the air. A back door leads to the yard. Something about the floorboards looks suspicious...', true, NULL, NULL);
INSERT INTO rooms (id, name, description, dig_enabled, dig_fail_message, background_image) VALUES (4, 'Library', 'Towering bookshelves line the walls, filled with leather-bound volumes thick with dust. A large ornate chest sits in the corner, its combination lock gleaming.', false, 'You can''t do that here..', NULL);
INSERT INTO rooms (id, name, description, dig_enabled, dig_fail_message, background_image) VALUES (5, 'Back Yard', 'You step into an overgrown yard. Weeds push through cracked paving stones, and an old fence surrounds the property. There''s a gate in the fence leading to freedom.', false, 'You can''t do that here..', NULL);
INSERT INTO rooms (id, name, description, dig_enabled, dig_fail_message, background_image) VALUES (6, 'Outside', 'You''ve made it outside! The fresh air hits your face as you step onto the open street. You''re free!', false, 'You can''t do that here..', NULL);

-- Insert Game Objects
INSERT INTO game_objects (id, name, description, object_type, item_size, item_weight) VALUES (1, 'Rusty Key', 'A rusty old key with teeth worn smooth by age.', 'item', 1, 1);
INSERT INTO game_objects (id, name, description, object_type, item_size, item_weight) VALUES (2, 'Paper Note', 'A crumpled piece of paper with "1234" scrawled on it in faded ink.', 'item', 1, 1);
INSERT INTO game_objects (id, name, description, object_type, item_size, item_weight) VALUES (3, 'Gold Coin', 'A heavy gold coin that gleams in the light. Worth a fortune!', 'item', 1, 3);
INSERT INTO game_objects (id, name, description, object_type, container_size, container_lock_fail_message, container_lock_success_message, container_lock_unlocked_desc, container_lock_state) VALUES (4, 'Treasure Chest', 'An ornate wooden chest with a combination lock on the front.', 'container', 10, 'The chest is locked tight! You need the combination.', 'The combination works! The lock clicks open.', 'The chest is open, revealing a gleaming gold coin inside.', 'locked');

-- Insert Exits
INSERT INTO exits (id, name, description, from_room_id, to_room_id, lock_fail_message, lock_success_message, lock_state) VALUES (1, 'Front Door', 'A heavy oak door with peeling red paint. It looks locked.', 1, 2, 'The door is locked tight. You need a key!', 'The rusty key turns in the lock with a satisfying click!', 'locked');
INSERT INTO exits (id, name, description, from_room_id, to_room_id, lock_fail_message, lock_success_message, lock_state) VALUES (2, 'Kitchen Door', 'A simple wooden door leading to the kitchen.', 2, 3, NULL, NULL, NULL);
INSERT INTO exits (id, name, description, from_room_id, to_room_id, lock_fail_message, lock_success_message, lock_state) VALUES (3, 'Library Door', 'A stately door with frosted glass panels leading to the library.', 2, 4, NULL, NULL, NULL);
INSERT INTO exits (id, name, description, from_room_id, to_room_id, lock_fail_message, lock_success_message, lock_state) VALUES (4, 'Back Door', 'A screen door leading to the back yard. It squeaks on rusty hinges.', 3, 5, NULL, NULL, NULL);
INSERT INTO exits (id, name, description, from_room_id, to_room_id, lock_fail_message, lock_success_message, lock_state) VALUES (5, 'Fence Gate', 'An old wooden gate in the fence. It swings freely - your path to freedom!', 5, 6, NULL, NULL, NULL);
INSERT INTO exits (id, name, description, from_room_id, to_room_id, lock_fail_message, lock_success_message, lock_state) VALUES (6, 'Fence Gate Return', 'The gate swings both ways, leading back to the yard.', 6, 5, NULL, NULL, NULL);
INSERT INTO exits (id, name, description, from_room_id, to_room_id, lock_fail_message, lock_success_message, lock_state) VALUES (7, 'Back Door Return', 'The screen door from the yard.', 5, 3, NULL, NULL, NULL);
INSERT INTO exits (id, name, description, from_room_id, to_room_id, lock_fail_message, lock_success_message, lock_state) VALUES (8, 'Kitchen Door Return', 'The kitchen door from the kitchen side.', 3, 2, NULL, NULL, NULL);
INSERT INTO exits (id, name, description, from_room_id, to_room_id, lock_fail_message, lock_success_message, lock_state) VALUES (9, 'Library Door Return', 'The library door from inside the library.', 4, 2, NULL, NULL, NULL);
INSERT INTO exits (id, name, description, from_room_id, to_room_id, lock_fail_message, lock_success_message, lock_state) VALUES (10, 'Front Door Return', 'The front door from inside the house.', 2, 1, NULL, NULL, NULL);

-- Insert Exit Lock Keys
INSERT INTO exit_lock_keys (exit_id, key_item_id) VALUES (1, 1);

-- Insert Container Items
INSERT INTO container_items (container_id, item_name, item_id) VALUES (4, 'Gold Coin', 3);

-- Insert Container Lock Keys
INSERT INTO container_lock_keys (container_id, key_item_id) VALUES (4, 2);

-- Insert Room-Exit associations
INSERT INTO room_exits (room_id, exit_name, exit_id) VALUES (1, 'Front Door', 1);
INSERT INTO room_exits (room_id, exit_name, exit_id) VALUES (2, 'Front Door Return', 10);
INSERT INTO room_exits (room_id, exit_name, exit_id) VALUES (2, 'Kitchen Door', 2);
INSERT INTO room_exits (room_id, exit_name, exit_id) VALUES (2, 'Library Door', 3);
INSERT INTO room_exits (room_id, exit_name, exit_id) VALUES (3, 'Back Door', 4);
INSERT INTO room_exits (room_id, exit_name, exit_id) VALUES (3, 'Kitchen Door Return', 8);
INSERT INTO room_exits (room_id, exit_name, exit_id) VALUES (4, 'Library Door Return', 9);
INSERT INTO room_exits (room_id, exit_name, exit_id) VALUES (5, 'Back Door Return', 7);
INSERT INTO room_exits (room_id, exit_name, exit_id) VALUES (5, 'Fence Gate', 5);
INSERT INTO room_exits (room_id, exit_name, exit_id) VALUES (6, 'Fence Gate Return', 6);

-- Insert Room-Object associations
INSERT INTO room_objects (room_id, object_name, object_id) VALUES (1, 'Rusty Key', 1);
INSERT INTO room_objects (room_id, object_name, object_id) VALUES (4, 'Treasure Chest', 4);

-- Insert Dig Definitions
INSERT INTO dig_definitions (room_id, sequence_order, success_message, game_object_id) VALUES (3, 1, 'You pry up a loose floorboard and find something hidden underneath!', 2);
INSERT INTO dig_definitions (room_id, sequence_order, success_message, game_object_id) VALUES (3, 2, 'You search more but find nothing else.', NULL);

-- Insert Player State
INSERT INTO player_state (id, current_room_id) VALUES (1, 1);

-- Insert Player Verbs
INSERT INTO player_verbs (verb_alias, verb_target) VALUES ('d', 'drop');
INSERT INTO player_verbs (verb_alias, verb_target) VALUES ('dig', 'dig');
INSERT INTO player_verbs (verb_alias, verb_target) VALUES ('drop', 'drop');
INSERT INTO player_verbs (verb_alias, verb_target) VALUES ('e', 'examine');
INSERT INTO player_verbs (verb_alias, verb_target) VALUES ('examine', 'examine');
INSERT INTO player_verbs (verb_alias, verb_target) VALUES ('h', 'help');
INSERT INTO player_verbs (verb_alias, verb_target) VALUES ('help', 'help');
INSERT INTO player_verbs (verb_alias, verb_target) VALUES ('i', 'inventory');
INSERT INTO player_verbs (verb_alias, verb_target) VALUES ('inventory', 'inventory');
INSERT INTO player_verbs (verb_alias, verb_target) VALUES ('l', 'look');
INSERT INTO player_verbs (verb_alias, verb_target) VALUES ('look', 'look');
INSERT INTO player_verbs (verb_alias, verb_target) VALUES ('o', 'open');
INSERT INTO player_verbs (verb_alias, verb_target) VALUES ('open', 'open');
INSERT INTO player_verbs (verb_alias, verb_target) VALUES ('p', 'pickup');
INSERT INTO player_verbs (verb_alias, verb_target) VALUES ('pickup', 'pickup');
INSERT INTO player_verbs (verb_alias, verb_target) VALUES ('put', 'put');
INSERT INTO player_verbs (verb_alias, verb_target) VALUES ('t', 'take');
INSERT INTO player_verbs (verb_alias, verb_target) VALUES ('take', 'take');
INSERT INTO player_verbs (verb_alias, verb_target) VALUES ('u', 'use');
INSERT INTO player_verbs (verb_alias, verb_target) VALUES ('use', 'use');
INSERT INTO player_verbs (verb_alias, verb_target) VALUES ('w', 'walk');
INSERT INTO player_verbs (verb_alias, verb_target) VALUES ('walk', 'walk');


COMMIT;
